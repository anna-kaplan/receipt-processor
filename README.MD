# Receipt Processor Exercise
## Task

Build a webservice that fulfils the documented API described below.
Data does not need to persist when application stops. It is sufficient to store information in memory.

---
### Summary of API Specification

#### Endpoint: Process Receipts

* Path: `/receipts/process`
* Method: `POST`
* Payload: Receipt JSON
* Response: JSON containing an id for the receipt.

Description:

Takes in a JSON receipt and returns a JSON object with an ID generated by the code.

The ID returned is the ID that should be passed into `/receipts/{id}/points` to get the number of points the receipt was awarded.

How many points should be earned are defined by the rules below.

Reminder: Data does not need to survive an application restart. This is to allow to use in-memory solutions to track any data generated by this endpoint.

Example Response:
``` json
{ "id": "7fb1377b-b223-49d9-a31a-5a02701dd310" }
```

### Endpoint: Get Points

* Path: `/receipts/{id}/points`
* Method: `GET`
* Response: A JSON object containing the number of points awarded.

A simple Getter endpoint that looks up the receipt by the ID and returns an object specifying the points awarded.

Example Response:
``` json
{ "points": 32 }
```

### Endpoint: View Processed Receipt (optional)
* Path: `/receipts/{id}`
* Method: `GET`
* Response: A JSON object containing the processed receipt with points awarded.

A simple Getter endpoint that looks up the receipt by the ID and returns an object specifying the points awarded.

Example Response:
``` json
{
  "receipt": {
    "id": "286cb54c-29ee-475c-8d42-bede9feab544",
    "items": [
      {
        "price": 3.99,
        "shortDescription": "Milk"
      },
      {
        "price": 2.5,
        "shortDescription": "Bread"
      },
      {
        "price": 4.29,
        "shortDescription": "Eggs"
      }
    ],
    "points": 21,
    "purchaseDateTime": "2023-10-22 15:30",
    "retailer": "Target",
    "total": 10.78
  }
}
```
---

## Rules

These rules collectively define how many points should be awarded to a receipt.

* One point for every alphanumeric character in the retailer name.
* 50 points if the total is a round dollar amount with no cents.
* 25 points if the total is a multiple of `0.25`.
* 5 points for every two items on the receipt.
* If the trimmed length of the item description is a multiple of 3, multiply the price by `0.2` and round up to the nearest integer. The result is the number of points earned.
* 6 points if the day in the purchase date is odd.
* 10 points if the time of purchase is after 2:00pm and before 4:00pm.


### Examples

``` json
{
  "retailer": "Target",
  "purchaseDate": "2022-01-01",
  "purchaseTime": "13:01",
  "items": [
    {
      "shortDescription": "Mountain Dew 12PK",
      "price": "6.49"
    },
    {
      "shortDescription": "Emils Cheese Pizza",
      "price": "12.25"
    },
    {
      "shortDescription": "Knorr Creamy Chicken",
      "price": "1.26"
    },
    {
      "shortDescription": "Doritos Nacho Cheese",
      "price": "3.35"
    },
    {
      "shortDescription": "   Klarbrunn 12-PK 12 FL OZ  ",
      "price": "12.00"
    }
  ],
  "total": "35.35"
}
```
``` text
Total Points: 28
Breakdown:
     6 points - retailer name has 6 characters
    10 points - 5 items (2 pairs @ 5 points each)
     3 Points - "Emils Cheese Pizza" is 18 characters (a multiple of 3)
                item price of 12.25 * 0.2 = 2.45, rounded up is 3 points
     3 Points - "Klarbrunn 12-PK 12 FL OZ" is 24 characters (a multiple of 3)
                item price of 12.00 * 0.2 = 2.4, rounded up is 3 points
     6 points - purchase day is odd
  + ---------
  = 28 points
```

----

``` json
{
  "retailer": "M&M Corner Market",
  "purchaseDate": "2022-03-20",
  "purchaseTime": "14:33",
  "items": [
    {
      "shortDescription": "Gatorade",
      "price": "2.25"
    },
    {
      "shortDescription": "Gatorade",
      "price": "2.25"
    },
    {
      "shortDescription": "Gatorade",
      "price": "2.25"
    },
    {
      "shortDescription": "Gatorade",
      "price": "2.25"
    }
  ],
  "total": "9.00"
}
```
``` text
Total Points: 109
Breakdown:
    50 points - total is a round dollar amount
    25 points - total is a multiple of 0.25
    14 points - retailer name (M&M Corner Market) has 14 alphanumeric characters
                note: '&' is not alphanumeric
    10 points - 2:33pm is between 2:00pm and 4:00pm
    10 points - 4 items (2 pairs @ 5 points each)
  + ---------
  = 109 points
```

---
# Solution Notes

## Receipt Processor implementation

Receipt data is processed into a Python dictionary as follows:

*   `purchaseDate` and `purchaseTime` fields are parsed to datetime and stored as `purchasedDateTime`.
*   `price` and `total` fields are converted to float.
*   The input JSON for `/receipts/process` is parsed with `expects_json` according to the spec via `request_schema` (see `src/receipt_apy.py`).

*   `receipt_storage` is a dictionary (non-persistent) that maps a processed `receipt_id` (key) to a processed receipt dictionary (value).

## Running receipt-processor locally:

1.  Navigate to the project folder:

    ``` bash
    cd "project-folder"
    ```

2.  Create a Python virtual environment:

    ``` bash
    python3 -m venv .venv
    ```

3.  Activate the virtual environment:

    ``` bash
    source .venv/bin/activate
    ```

4.  Install required libraries:

    ``` bash
    pip install Flask flask_expects_json
    ```

5.  Start the receipt processor:

    ``` bash
    python3 src/receipt_api.py
    ```

## Running in Docker:

1.  Open a terminal and navigate to the `receipt-processor-challenge` directory (containing the `Dockerfile`).

2.  Build the Docker image (container name `receipt-processor`):

    ``` bash
    docker build -t receipt-processor .
    ```

3.  Run the container (container port 5000 is mapped to port 5000 on the local machine):

    ``` bash
    docker run --name receipt-processor -p 5000:5000 receipt-processor
    ```

## Querying receipt-processor:

Once the receipt-process is started, we can query it from a local terminal
Try run the following examples:

*   **Process a receipt:**

    ``` bash
    curl -X POST -H "Content-Type: application/json" -d '{
        "retailer": "Target",
        "purchaseDate": "2023-10-22",
        "purchaseTime": "15:30",
        "items": [
            {"shortDescription": "Milk", "price": "3.99"},
            {"shortDescription": "Bread", "price": "2.50"},
            {"shortDescription": "Eggs", "price": "4.29"}
        ],
        "total": "10.78"
    }' http://127.0.0.1:5000/receipts/process
    ```

    The reply will show a UUID string as the processed receipt ID. This can be used to call another API endpoint.
    ``` json
    {"id":"286cb54c-29ee-475c-8d42-bede9feab544"}
    ```

    Running same request more time(s) will produce duplicate error message with information on retailer and purchaseDateTime
    ``` json
      {"message":"Provided receipt is duplicate: ('Target', '2023-10-22 15:30')"}
    ```

*   **Get points for a receipt:**

    ``` bash
    curl -X GET -H "Content-Type: application/json" http://127.0.0.1:5000/receipts/<receipt_id-from-above-reply>/points
    ```

    or

    ``` bash
    open http://127.0.0.1:5000/receipts/<receipt_id-from-above-reply>/points
    ```

*   **Additional point to view whole receipt:**

    ``` bash
    curl -X GET -H "Content-Type: application/json" http://127.0.0.1:5000/receipts/<receipt_id-from-above-reply>
    ```

    or

    ``` bash
    open http://127.0.0.1:5000/receipts/<receipt_id-from-above-reply>
    ```
